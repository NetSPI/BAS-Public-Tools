
@echo off
cls

REM ########################################################################
REM Scriptname: WinConfigDump.bat
REM Verion: 1.0
REM Date: 12/12/2009
REM This script was created by NetSPI to be used for information collection
REM ########################################################################

:SYNTAX
echo .
echo                                              ...IIIII7?.... 
echo                                             ..7I.......I7.. 
echo                                             .I....,......I. 
echo                                             I?..D8,~D88..7~.
echo                                             I.,,..8O=..D.,7.
echo                     ......                  I....OZZZ....:I.
echo                     ...I+.                  .I....$O.....I. 
echo II.IIII+.....=III7,..IIIII7.. OD8888..D88888?~I.,8$,,...7.. 
echo 7II....II...77...,I+...I+....88O......88:..888.+888+.,7~... 
echo 7I.. ..7I..7I,....I7...I+.  .D88=..  .88:..D8D..88D.....    
echo 7I.  ..7I..I77777777...I+.   .:88888..8888888...88... ..    
echo 7I.  ..7I..I7..........7+.   ....$88..88:,.....+88...       
echo 7I.  ..7I...7I.........II....87..888..88:      D8~          
echo II.  ..7I....+7III7~   ,III..8D88D$...88~    . D8.  
echo ............................................................
echo     RISK           COMPLIANCE           SECURITY
echo ............................................................
echo ##########################################################
echo         WinConfigDump 
echo ##########################################################
echo .
REM Check fo DC, Member Server or Workstations
:SYSTYPECHK
set /p systype= Enter D for Domain Controller, M for Member Server:

REM Check fo DC, Member Server or Workstations
if "%systype%"=="D" GOTO :DOMAIN
if "%systype%"=="M" GOTO :MEMBER
GOTO :SYSTYPECHK

:DOMAIN
REM ##Create NetSPI Directory and Create Output In it
MD NetSPI_config
cd NetSPI_config

echo ###############################################
echo - Starting Configuration Dump - Domain Setting
echo ----------------------------------------------
echo ------------------------------------------------------------>> %computername%.txt
echo !!Domain Users and Groups >> %computername%.txt
echo ------------------------------------------------------------>> %computername%.txt
echo - Recording Domain User and Group Information
net group /domain >> %computername%.txt
net users /domain >> %computername%.txt
net group "Domain Admins" /domain >> %computername%.txt
net group "Enterprise Admins" /domain >> %computername%.txt
GOGO :SKIP

:MEMBER
REM ##Create NetSPI Directory and Create Output In it
MD NetSPI
cd NetSPI
GOTO :SKIP

:SKIP
echo ###############################################
echo - Starting Configuration Dump - Local Settings
echo ----------------------------------------------
echo ------------------------------------------------------------>> %computername%.txt
echo !!LOCAL OS VERSION >> %computername%.txt
echo ------------------------------------------------------------>> %computername%.txt
echo - Recording OS version
ver >> %computername%.txt


echo ------------------------------------------------------------>> %computername%.txt
echo !!LOCAL System Information >> %computername%.txt
echo ------------------------------------------------------------>> %computername%.txt
echo - Recording Local System Information
systeminfo >> %computername%.txt


echo ------------------------------------------------------------>> %computername%.txt
echo !!IP CONFIGURATION >> %computername%.txt
echo ------------------------------------------------------------>> %computername%.txt
echo - Recording Network Configuration
ipconfig /all >> %computername%.txt


echo ------------------------------------------------------------>> %computername%.txt
echo !!Interface Information >> %computername%.txt
echo ------------------------------------------------------------>> %computername%.txt
echo - Recording Network Configuration
getmac >> %computername%.txt

echo ------------------------------------------------------------>> %computername%.txt
echo !!Local Users and Groups >> %computername%.txt
echo ------------------------------------------------------------>> %computername%.txt
echo - Recording Local User and Group Information
net users >> %computername%.txt
net localgroup >> %computername%.txt
net localgroup administrators >> %computername%.txt


echo ------------------------------------------------------------>> %computername%.txt
echo !!Local Password and Account Policy >> %computername%.txt
echo ------------------------------------------------------------>> %computername%.txt
echo - Recording Local Account Policies
net accounts >> %computername%.txt


echo ------------------------------------------------------------>> %computername%.txt
echo !!Domain Group Policy >> %computername%.txt
echo ------------------------------------------------------------>> %computername%.txt
echo - Recording Domain Account and Group Policies
gpresult /scope computer /Z >> %computername%.txt


echo ------------------------------------------------------------>> %computername%.txt
echo !!Service Information!! >> %computername%.txt
echo ------------------------------------------------------------>> %computername%.txt
echo - Recording List of Services
sc query >> %computername%.txt

echo ------------------------------------------------------------>> %computername%.txt
echo !!Running Processes/Tasks!! >> %computername%.txt
echo ------------------------------------------------------------>> %computername%.txt
echo - Recording Task List
tasklist >> %computername%.txt


echo ------------------------------------------------------------>> %computername%.txt
echo !!Listening Ports and Associated Executables >> %computername%.txt
echo ------------------------------------------------------------>> %computername%.txt
echo - Recording Listening Ports and Associated Executables
netstat -anb >> %computername%.txt


echo ------------------------------------------------------------>> %computername%.txt
echo !!Listening Ports >> %computername%.txt
echo ------------------------------------------------------------>> %computername%.txt
echo - Recording Listening Ports
netstat -an | find "LISTEN" >> %computername%.txt


echo ------------------------------------------------------------>> %computername%.txt
echo !!Firewall Configuration >> %computername%.txt
echo ------------------------------------------------------------>> %computername%.txt
echo - Recording Firewall Configuration
netsh firewall show config >> %computername%.txt
netsh firewall show portopening >> %computername%.txt


echo ------------------------------------------------------------>> %computername%.txt
echo !!Local Shares >> %computername%.txt
echo ------------------------------------------------------------>> %computername%.txt
echo - Recording Local Share Information
net share >> %computername%.txt

echo ------------------------------------------------------------>> %computername%.txt
echo !!Mounted Shares >> %computername%.txt
echo ------------------------------------------------------------>> %computername%.txt
echo - Recording Local Share Information
net use >> %computername%.txt

echo ------------------------------------------------------------>> %computername%.txt
echo !!Local Disks >> %computername%.txt
echo ------------------------------------------------------------>> %computername%.txt
echo - Recording Local Disk Information
echo List Disk > script
diskpart /s < script >> %computername%.txt
del script


echo ------------------------------------------------------------>> %computername%.txt
echo !!Local Date and Time >> %computername%.txt
echo ------------------------------------------------------------>> %computername%.txt
echo - Recording Local Date and Time
date /t >> %computername%.txt
time /t >> %computername%.txt


echo ------------------------------------------------------------>> %computername%.txt
echo !!Local Environmental Variables >> %computername%.txt
echo ------------------------------------------------------------>> %computername%.txt
echo - Recording Environmental variables
set >> %computername%.txt

echo ------------------------------------------------------------>> %computername%.txt
echo !!Scheduled Task Information >> %computername%.txt
echo ------------------------------------------------------------>> %computername%.txt
echo - Recording Schedule Tasks
schtasks /query /v >> %computername%.txt


echo - Configuration Dump Complete
echo ##############################################

pause
